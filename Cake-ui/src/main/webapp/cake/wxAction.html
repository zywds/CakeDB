<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>微信支付</title>
		<!--头部-->
		<link rel="stylesheet" href="myjs/maintop.css"/>
		<!--底部-->
		<link rel="stylesheet" href="myjs/mianbottom.css"/>
		<link rel="stylesheet" href="js/layui/css/layui.css"/>
		<!--内容部分-->
		<link rel="stylesheet" href="myjs/maincenter.css"/>
		<link rel="icon" href="iconfont/cakeType.png" type="image/x-icon" />
	</head>
	<style>
		.div_center{width: 1200px;
			overflow: hidden;;display: block;margin: 0 auto;position: relative;
			top: 130px;margin-bottom: 60px;
		}
		.h2_1{font-size: 16px;
			color: #383838;
			font-weight: bold;}
		.order-info{color: #bdbdbd;
			font-size: 14px;
			line-height: 18px;
			margin-top: 7px;
			overflow: hidden;
			border-bottom: 2px solid #ECECEC;
			padding-bottom: 16px;}
		.order-info>span{display: inline-block;
			float: left;
			margin-right: 130px;}
		.order-info > span:last-child span {
			color: #FF714D;
		}
		.order-info > span:last-child {
			font-weight: bold;
			font-size: 16px;
			color: #383838;
		}
		.weixin-erweima {
			width: 700px;
			overflow: hidden;
			margin-left: 230px;
			margin-top: 90px;
			height: 518px;
		}
		.weixin-erweima .erweima {
			width: 200px;
			float: left;
			margin-top: 25px;
		}
		.weixin-erweima p {
			font-size: 24px;
			color: #383838;
			text-align: center;
			font-weight: bold;
			margin-top: 15px;
		}
		.weixin-erweima .weixin-tips {
			float: left;
			margin-left: 140px;
		}
		#pay{
			width: 100px;
			background: red;
			height: 29px;
			color: white;
			margin-top: -10px;
			line-height: 29px;
			margin-left: 124px;
		}
	</style>
	<body>
		<!--头部-->
		<div class="div_Main">
			<div class="header-nav">
				<a class="header-logo" href="#">
					<img src="images-other/logo.png" alt="21cake logo" width="100%" height="100%">
	        	</a>
	        	<ul class="nav-box">
	        		<li><a href="Main.html">首页</a></li>
	                <li><a href="cakeType.html?ctId=1" target="_self">蛋糕</a></li>
	                <li><a href="cakeType.html?ctId=2" target="_self">冰淇淋</a></li>
	                <li><a href="cakeType.html?ctId=3" target="_self">咖啡下午茶</a></li>
	                <li><a href="#" target="_self">咖啡全国送</a></li>
	                <li><a href="#" target="_self">企业专区</a></li>
            	</ul>
            	<div class="nav-box-right">
            		<a href="#" class="dowload_a">app下载
            			<div class="dowload_div">
            				<div class="dowload_div_img">
            					<img src="images-other/footer-erweima.png" width="100%" height="100%"/>
            				</div>
            				<span class="dowload_div_span">下载更多优惠</span>
            			</div>
            		</a>
            		<a href="#" class="city_a">上海<i class="layui-icon layui-icon-triangle-d"></i>
            			<div class="city_a_div">
            				<span class="spancity">上海</span>
            				<span class="spancity">天津</span>
            				<span class="spancity">北京</span>
            				<span class="spancity">杭州</span>
            				<span class="spancity">江西</span>
            				<span class="spancity">珠海</span>
            				<span class="spancity">广州</span>
            			</div>
            		</a>
            		<a href="#" class="message_a">消息
            			<div class="message_a_div">
							<span class="spanmessage" id="myOrdering">我的订单</span>
							<span class="spanmessage">我的优惠</span>
							<span class="spanmessage">活动提示</span>
            			</div>
            		</a>
					<a href="login.html" class="login_a" style="margin-right: -26px;width: 148px">欢迎您  <span id="span_users"></span></a>
            		<!--<a href="#" class="line_a">,</a>
            		<a href="regsist.html" class="regsist_a">欢迎您</a>-->
            		<a href="ShoppingCar.html" class="shoppingcar_a"><i class="layui-icon layui-icon-cart"></i></a>
            	</div>
        	</div>
		</div>
		<!--头部-->
		<!--主体-->
		<div class="div_center">
			<h2 class="h2_1">微信支付</h2>
			<div class="order-info">
				<span>订单号：<span id="oNo"></span></span>
				<span>收款方：北京廿一客食品有限公司</span>
				<span>您需支付：<span id="odSumPrice"></span></span>
				<input type="button" id="pay" value="支付"/>
			</div>
			<div class="weixin-erweima">
				<div class="erweima">
					<div id="wx_pub_qr" title=""><!--<canvas width="182" height="182" style="display: none;"></canvas>--><!--<img alt="Scan me!" style="display: block;" src="../images/index.png">--><div id="qrcode" style="display: block;margin-left: 23px;margin-top: 40px"></div></div>
					<p>微信扫一扫支付</p>
				</div>
				<div class="weixin-tips">
					<img src="../images/weixin-tips.png">
				</div>
			</div>
		</div>
		<!--主体-->
		<!--底部-->
		<div class="div_bottom">
			<img class="div_bottom_logo" src="images-other/footer-logo.png" alt="" width="96" height="36">
			<div class="footer-nav">
		        <a href="/doc-about-55.html">联系我们</a>
		        <span>|</span>
		        <a href="/doc-distribution-40.html">订购帮助</a>
		        <span>|</span>
		        <a href="/doc-about-56.html">企业合作</a>
		        <span>|</span>
		        <a href="/doc-about-115.html">生产经营资质</a>
		        <span>|</span>
		        <a href="/article-company.html">公告专区</a>
		    </div>
		    <div class="footer-icon">
		    	<a href="#"><i class="layui-icon layui-icon-login-weibo"></i></a>
		    	<a href="#"><i class="layui-icon layui-icon-login-wechat"></i></a>
		    	<a href="#"><i class="layui-icon layui-icon-login-qq"></i></a>
		    </div>
		    <div class="footer-text">
		        <span>订购专线：400 650 2121（服务时间 08:00–22:00）</span>
		        <span>客服电话：021-23099721（全国） | kefu@21cake.com（邮箱）</span>
		        <span>杭州/广州：提前5小时预订；北京：提前6小时预订；上海：提前5.5-6小时预订；天津/苏州/无锡/深圳：提前8小时预订（当日22点以后订单，于次日8点开始审核） </span>
		        <span>当日蛋糕配送截止下单时间：北京：16:50；上海：16:30；杭州/广州：13:50；天津：10:30；苏州/无锡/深圳：11:00</span>
		        <span>网站注册公司名称: 北京廿一客食品有限公司 地址: 北京市北京经济技术开发区兴海二街5号院3号楼 </span>
		    </div>
		    <div class="footer-copyright">
		        <span>Copyright© 21Cake蛋糕官网商城 2007-2018, 版权所有 <a style="color: #9a9a9a" target="_blank" href="http://www.miitbeian.gov.cn/">京ICP备14006254号-1</a></span>
		    </div>
		</div>
		<!--底部-->
		<script src="js/layui/layui.all.js"></script>
		<script src="js/jquery-1.11.3.js"></script>
		<script src="js/unslider.min.js"></script>
		<!--图片预加载-->
		<script type="text/javascript" src="js/jquery.lazyload.js"></script>
		<script src="../js/qrcode.js"></script>
		<!--导入main.js-->
		<script src="myjs/main.js"></script>
		<script>
            //获取url中的值
            //获得值应该在到达窗体就加载，而不是加载完成
            function getUrlParam(name){
                var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if(r!=null)
                    return decodeURI(r[2]);
                return null;
            };
            var oNo=getUrlParam("oNo");
            var oId=getUrlParam("oId");
            var odSumPrice=getUrlParam("odSumPrice");
            $("#oNo").html(oNo);$("#odSumPrice").html(odSumPrice);
            //轮循
			function selectOstateByOId(){
                $.ajax({
                    url:'OrderingServlet/selectOrderingOstateByOId',
                    type:'get',
                    data:{oId:oId}
                }).done(function (result) {
                    if(result==1){
                        layer.msg("支付成功！正在跳转...");
                        setTimeout(function () {
                            location.href="myOrdering.html";
                        },1000);
					}
                });
			};setInterval(function () {
				selectOstateByOId();
            },3000);
			//获得电话号码
            $.ajax({
                url:'UserRegsistMainServlet/getPhone',
                type:'get'
            }).done(function (result) {
                $("#span_users").html(result);
            });
			//支付
			$("#pay").click(function () {
                $.ajax({
                    url:'OrderingServlet/updateOrdingStateByOId2',
                    type:'post',
                    data:{oId:oId}
                }).done(function (result) {
                    layer.msg(result+"正在跳转。。。。");
                    setTimeout(function () {
						location.href="myOrdering.html";
                    },1000)
                });
            });
            $("#myOrdering").click(function () {
                location.href="myOrdering.html";
            });
            var qrCode;var qrcode;
            qrCode= document.getElementById("qrcode");
            // var txtContent = jsdata;
            qrcode=new QRCode(qrCode,{
                render : "canvas",
                width:150,
                height:150,
                text:"http://172.20.10.3:8080/cake/paysuccess.html?oNo="+oNo+"&oSumPrice="+odSumPrice+"&oId="+oId,
                correctLevel:QRCode.CorrectLevel.L
            });
		</script>
	</body>
</html>
